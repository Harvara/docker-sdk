# syntax = docker/dockerfile:experimental
ARG SPRYKER_PLATFORM_IMAGE
FROM ${SPRYKER_PLATFORM_IMAGE}

ARG USER_UID
ARG APPLICATION_ENV
ARG SPRYKER_DB_ENGINE
ENV APPLICATION_ENV=${APPLICATION_ENV}
ENV SPRYKER_DB_ENGINE=${SPRYKER_DB_ENGINE}
ARG DEPLOYMENT_PATH
ARG KNOWN_HOSTS
ENV SPRYKER_DB_ENGINE=${SPRYKER_DB_ENGINE}
ENV SPRYKER_IN_DOCKER=1
ENV DEVELOPMENT_CONSOLE_COMMANDS=1

ENV PATH=/data/vendor/bin:$PATH

RUN usermod -u ${USER_UID} spryker

COPY ${DEPLOYMENT_PATH}/context/php/conf.d/71-opcache-dev.ini /usr/local/etc/php/conf.d

ARG SPRYKER_BUILD_HASH='current'
ENV SPRYKER_BUILD_HASH=${SPRYKER_BUILD_HASH}
ARG SPRYKER_BUILD_STAMP=''
ENV SPRYKER_BUILD_STAMP=${SPRYKER_BUILD_STAMP}

CMD [ "php-fpm", "--nodaemonize" ]
EXPOSE 9000
