{% set port = (endpoint | split(':'))[1] | default(ssl ? 443 :80) %}
{% set host = endpoint | split(':') | first %}
server {
{% block server %}
{% block host %}
  server_name {{ host }};
  listen {{ port }} {{ ssl ? 'ssl http2' }};
{% if ssl %}
  include /etc/nginx/vhost.d/ssl.default.conf;
{% endif %}
{% endblock host %}
  access_log /dev/stdout combined;
  error_log /dev/stderr;

{% block locations %}
  location / {
    proxy_pass http://{% block upstream %}{{ upstream }}{% endblock upstream %};
  }
{% endblock locations %}
{% endblock server %}
}
