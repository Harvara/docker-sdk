{% extends "nginx/http/server.conf.twig" %}
{% block host %}
{{ parent() }}
{% include "nginx/http/error.conf.twig" with _context %}
{% endblock host %}
{% block locations %}
    root /data/public/{{ endpointData['entry-point'] }};

    if ($request_uri ~* "^(.*/)index\.php(.*)$") {
        return 301 $1;
    }

{% include "nginx/http/static.conf.twig" with _context %}

{% include "nginx/http/build.conf.twig" with _context %}

    location @proxy {
{% block location %}
        proxy_set_header Host $host;
        add_header X-Server $hostname;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;

        set $upstream http://{% block upstream %}{{ upstream }}{% endblock upstream %};
        proxy_pass $upstream;
{% endblock location %}
    }
{% endblock locations %}
