    location /assets/ {
        access_log  off;
        expires     7d;
        add_header  Pragma public;
        add_header  Cache-Control "public, must-revalidate, proxy-revalidate";
        etag on;
        try_files   $uri @assets;
    }

    location @assets {
        rewrite ^/assets/[^/]+/(.*)$ /__assets__fallback/${SPRYKER_BUILD_HASH}/$1 last;
    }

    location ~* /__assets__fallback/(.*) {
        access_log        off;
        add_header        Last-Modified 'Thu, 01 Jan 1970 00:00:00 GMT';
        add_header        Cache-Control 'no-store, no-cache';
        if_modified_since off;
        expires           off;
        etag              off;

        try_files         /assets/$1 =404;
    }

    location / {

        {% if auth['engine'] is not empty and auth['engine'] == 'basic' %}
        if ($request_method = OPTIONS) {
            add_header Content-Length 0;
            add_header Content-Type text/plain;
            add_header Access-Control-Allow-Methods "GET, POST, PUT, PATCH, DELETE, OPTIONS";
            add_header Access-Control-Allow-Origin $http_origin;
            add_header Access-Control-Allow-Headers "Authorization, Content-Type";
            add_header Access-Control-Allow-Credentials true;
            return 200;
        }
        {% endif %}

        access_log  off;
        expires     7d;
        add_header  Pragma public;
        add_header  Cache-Control "public, must-revalidate, proxy-revalidate";
        etag on;
        try_files   $uri @proxy;
    }
