{% set schema = _project['docker']['ssl']['enabled'] ? 'https://' : 'http://' %}
{% set hostname = applicationData['endpoints'] | keys | first | split(':') | first %}
  {{ applicationName | lower }}:
    image: ${SPRYKER_DOCKER_PREFIX}_worker_app:${SPRYKER_DOCKER_TAG}-{{ applicationName | lower }}
    hostname: {{ hostname }}
    depends_on:
        - database
        - broker
        - key_value_store
        - search
    networks:
        - private
    labels:
        'spryker.app.name': {{ applicationName }}
        'spryker.app.type': scheduler
        'spryker.project': ${SPRYKER_DOCKER_PREFIX}:${SPRYKER_DOCKER_TAG}
    healthcheck:
        test: [ "CMD", "nc", "-z", "localhost", "3012" ]
        interval: 10s
        timeout: 5s
        retries: 5
    environment:
        CRONICLE_master_ping_freq: 1
        CRONICLE_master_ping_timeout: 1
        CRONICLE_base_app_url: {{ schema ~ hostname }}
        CRONICLE_smtp_hostname: 'mail_catcher'
        CRONICLE_smtp_port: 1025
    env_file:
        - ${DEPLOYMENT_PATH}/env/{{ applicationName }}.env
    volumes:
        - {{ applicationName | lower }}-data:/home/spryker/cronicle/data
        - logs:${SPRYKER_LOG_DIRECTORY}:rw
{% if _mountMode != 'baked' %}
{% if _mountMode == 'native' %}
        - ./:/data
{% else %}
        - ${SPRYKER_DOCKER_PREFIX}_${SPRYKER_DOCKER_TAG}_data_sync:/data
{% endif %}
{% endif %}
