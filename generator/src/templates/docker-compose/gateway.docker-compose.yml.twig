version: "3.7"

services:
{% for serviceName, serviceData in sharedServices %}
{% set engine = serviceData['engine'] | lower %}
{% set version = serviceData['version'] | default('default') %}
{% include "service/" ~ engine ~ "/" ~ version ~ "/" ~  engine ~ ".yml.twig" with {
    serviceName: serviceName,
    serviceData: serviceData,
    engine: engine,
    version: version,
    project_name: project_name,
} only %}
{% endfor %}

volumes:
{% for serviceName, serviceData in sharedServices %}
{% set volume_name = docker_sdk_project_name ~ '-' ~ serviceName ~ '-' ~ serviceData['engine'] ~ '-data' %}
  {{ volume_name }}:
    name: {{ volume_name }}
    external: false
{% endfor %}

{% include "docker-compose/components/network.yml.twig" with _context %}
